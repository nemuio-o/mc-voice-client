<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“» Live Radio Channels</title>
  <style>
    * {margin:0;padding:0;box-sizing:border-box}
    body{background:linear-gradient(135deg,#0f0c29 0%,#302b63 50%,#24243e 100%);color:#eee;font-family:'Segoe UI',system-ui,sans-serif;min-height:100vh;padding:20px}
    .container{max-width:1200px;margin:0 auto}
    .header{text-align:center;margin-bottom:40px;padding:40px 20px;background:rgba(15,12,41,0.6);border-radius:16px;backdrop-filter:blur(10px)}
    .header h1{font-size:3em;background:linear-gradient(45deg,#f093fb 0%,#f5576c 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px}
    .status-bar{display:flex;justify-content:center;gap:30px;flex-wrap:wrap;margin-bottom:30px}
    .status-item{background:rgba(255,255,255,0.1);padding:12px 24px;border-radius:20px}
    .channels-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px}
    .channel-card{background:linear-gradient(135deg,rgba(240,147,251,0.1) 0%,rgba(245,87,108,0.1) 100%);border:2px solid rgba(240,147,251,0.3);border-radius:16px;padding:24px;backdrop-filter:blur(10px);transition:all 0.3s}
    .channel-card:hover{transform:translateY(-5px);box-shadow:0 8px 32px rgba(240,147,251,0.2)}
    .channel-name{font-size:1.8em;font-weight:700;background:linear-gradient(45deg,#f093fb 0%,#f5576c 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:15px}
    .live-indicator{animation:pulse 2s infinite;font-size:0.5em;color:#48bb78}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
    .member-badge{background:rgba(255,255,255,0.15);padding:6px 12px;border-radius:12px;font-size:0.9em;border:1px solid rgba(240,147,251,0.3);display:inline-block;margin:4px}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“» Live Radio Channels</h1>
      <p>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ©ã‚¸ã‚ªãƒãƒ£ãƒ³ãƒãƒ«ã‚’è¡¨ç¤º</p>
    </div>
    <div class="status-bar">
      <div class="status-item">WebSocket: <span id="wsStatus">ğŸŸ¢ æ¥ç¶šä¸­</span></div>
      <div class="status-item">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ£ãƒ³ãƒãƒ«: <span id="channelCount">0</span></div>
    </div>
    <div id="channelsContainer" class="channels-grid"></div>
  </div>
  <script>
const API_URL='https://mc-voice-relay.nemu1.workers.dev'
const WS_URL='wss://mc-voice-relay.nemu1.workers.dev/ws'
let ws=null
function connect(){
  ws=new WebSocket(WS_URL+'?live=true')
  ws.onopen=()=>{
    document.getElementById('wsStatus').innerHTML='ğŸŸ¢ æ¥ç¶šä¸­'
    fetchChannels()
  }
  ws.onclose=()=>{
    document.getElementById('wsStatus').innerHTML='ğŸ”´ åˆ‡æ–­'
    setTimeout(connect,5000)
  }
  ws.onmessage=(e)=>{
    try{
      const d=JSON.parse(e.data)
      if(d.type==='radio_update')fetchChannels()
    }catch(err){}
  }
}
async function fetchChannels(){
  try{
    const res=await fetch(API_URL+'/radio/channels/public')
    const data=await res.json()
    if(data.channels)render(data.channels)
  }catch(e){}
}
function render(list){
  const c=document.getElementById('channelsContainer')
  if(!list.length){c.innerHTML='<p style="text-align:center;color:#aaa">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒãƒ£ãƒ³ãƒãƒ«ãŒã‚ã‚Šã¾ã›ã‚“</p>';return}
  c.innerHTML=list.map(ch=>`
    <div class="channel-card">
      <div class="channel-name"><span class="live-indicator">â—</span> ${ch.name}</div>
      <div>ğŸ‘¥ ${ch.members.length}äºº</div>
      <div>${ch.members.map(m=>'<span class="member-badge">'+m+'</span>').join('')}</div>
    </div>
  `).join('')
  document.getElementById('channelCount').textContent=list.length
}
connect()
setInterval(fetchChannels,30000)
  </script>
</body>
</html>
